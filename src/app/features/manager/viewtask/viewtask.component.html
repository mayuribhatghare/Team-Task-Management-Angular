<div class="assigned-task-container">
  <mat-card class="assigned-task-card">   
    <mat-card-content>

      <!-- Page Title -->
      <div class="assigned-title"> View Task Assigned to Users</div>

      <!-- User Dropdown -->
      <div class="dropdown-wrapper">
        <mat-form-field appearance="outline" class="user-select">
          <mat-label>Select User</mat-label>
          <mat-select [(value)]="selectedUserId" (selectionChange)="onUserChange($event.value)">
            <mat-option *ngFor="let user of users" [value]="user.UserId">
              {{ user.UserName }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
 

      <!-- Task Table -->
     <div *ngIf=" tableReady && tasks.length > 0 && selectedUserId !== null; else noTasks" class="table-wrapper">
        
    <table mat-table [dataSource]="filteredTasks"
       matSort
       class="mat-elevation-z2 full-width-table">
          <!-- Title -->
          <ng-container matColumnDef="Title">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Title</th>
            <td mat-cell *matCellDef="let task">
              <div class="truncate-text" matTooltip="{{ task.Title }}">{{ task.Title }}</div>
            </td>
          </ng-container>

          <!-- Description -->
          <ng-container matColumnDef="Description">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Description</th>
            <td mat-cell *matCellDef="let task">
              <div class="truncate-text" matTooltip="{{ task.Description }}">{{ task.Description }}</div>
            </td>
          </ng-container>

          <!-- Priority -->
          <ng-container matColumnDef="Priority">
            <th mat-header-cell *matHeaderCellDef>Priority</th>
            <td mat-cell *matCellDef="let task">{{ task.Priority }}</td>
          </ng-container>

          <!-- Status -->
          <ng-container matColumnDef="Status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let task">{{ task.Status }}</td>
          </ng-container>

          <!-- Due Date -->
          <ng-container matColumnDef="DueDate">
            <th mat-header-cell *matHeaderCellDef>Due Date</th>
            <td mat-cell *matCellDef="let task">{{ task.DueDate | date: 'mediumDate' }}</td>
          </ng-container>

          <!-- User Name -->
          <ng-container matColumnDef="UserName">
            <th mat-header-cell *matHeaderCellDef>UserName</th>
            <td mat-cell *matCellDef="let task">{{ task.UserName }}</td>
          </ng-container>

          <!-- Action Buttons -->
        <ng-container matColumnDef="Action">
          <th mat-header-cell *matHeaderCellDef class="action-header">Action</th>
            <td mat-cell *matCellDef="let task" class="action-cell">
          <div class="action-buttons">
          <button mat-icon-button color="primary" matTooltip="View Task"
              (click)="viewTask(task.TaskId)">
          <mat-icon>visibility</mat-icon>
          </button>
          <button mat-icon-button color="warn" matTooltip="Delete Task"
              (click)="deleteTask(task.TaskId)">
              <mat-icon>delete</mat-icon>
        </button>
        </div>
      </td>
      </ng-container>


          <!-- Render rows -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns" class="custom-header-row"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>

        <!-- Paginator -->
        <mat-paginator
          [pageSize]="5"
          [pageSizeOptions]="[5, 10, 20]"
          [showFirstLastButtons]="true">
        </mat-paginator>
      </div>

      <!-- No tasks -->
      <ng-template #noTasks>
        <div class="no-tasks" *ngIf="selectedUserId !== null && tasks.length === 0">
          No tasks assigned to this user.</div>
        <div class="no-tasks" *ngIf="selectedUserId == null">
          Please select a user to view the assigned task
        </div>
      </ng-template>

    </mat-card-content>
  </mat-card>
</div>
